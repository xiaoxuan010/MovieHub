<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="space.astralbridge.spring.moviehub.mapper.MovieRankingMapper">

    <resultMap id="rankingMovieResultMap" type="space.astralbridge.spring.moviehub.entity.Movie">
        <id property="id" column="MOVIE_ID"/>
        <result property="title" column="MOVIE_TITLE"/>
        <result property="description" column="MOVIE_DESCRIPTION"/>
        <result property="releaseDate" column="MOVIE_RELEASE_DATE"/>
        <result property="duration" column="MOVIE_DURATION"/>
        <result property="coverImage" column="MOVIE_COVER_IMAGE"/>
        <result property="region" column="MOVIE_REGION"/>
        <result property="isVip" column="MOVIE_IS_VIP"/>
        <result property="playCount" column="MOVIE_PLAY_COUNT"/>
        <result property="score" column="MOVIE_SCORE"/>
        <result property="createTime" column="MOVIE_CREATE_TIME"/>
        <result property="updateTime" column="MOVIE_UPDATE_TIME"/>
    </resultMap>

    <select id="selectMoviesRanked" resultMap="rankingMovieResultMap">
        SELECT
        M.ID AS MOVIE_ID,
        M.TITLE AS MOVIE_TITLE,
        M.DESCRIPTION AS MOVIE_DESCRIPTION,
        M.RELEASE_DATE AS MOVIE_RELEASE_DATE,
        M.DURATION AS MOVIE_DURATION,
        M.COVER_IMAGE AS MOVIE_COVER_IMAGE,
        M.REGION AS MOVIE_REGION,
        M.IS_VIP AS MOVIE_IS_VIP,
        M.PLAY_COUNT AS MOVIE_PLAY_COUNT,
        M.SCORE AS MOVIE_SCORE,
        M.CREATE_TIME AS MOVIE_CREATE_TIME,
        M.UPDATE_TIME AS MOVIE_UPDATE_TIME
        FROM MOVIE AS M
        <choose>
            <when test="sortBy == 'score'">
                ORDER BY M.SCORE ${order}
            </when>
            <when test="sortBy == 'play_count'">
                ORDER BY M.PLAY_COUNT ${order}
            </when>
            <when test="sortBy == 'release_date'">
                ORDER BY M.RELEASE_DATE ${order}
            </when>
            <otherwise>
                ORDER BY M.ID ${order}
            </otherwise>
        </choose>
    </select>

</mapper>
